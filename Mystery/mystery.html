<div class="character-sheet">
    <div class="row">
        <div class="col-12">
            <img src="https://raw.githubusercontent.com/Velczer/CharacterSheets/master/Mystery/Images/logo.png" alt="">
        </div>
    </div>
	<div class="row">
		<div class="col-6">
            <h2 class="title right-hr" data-i18n="description">Opis</h2>
            <div class="input-with-label">
                <label>Forma</label>
                <input type="text" name="attr_form">
            </div>

            <div class="input-with-label">
                <label>Imię</label>
                <input type="text" name="attr_character_name">
            </div>
		</div>

        <div class="col-6">
            <h2 class="title left-hr" data-i18n="portrait">Portret</h2>
            <div class="avatar">
                <img name="attr_character_avatar">
            </div>
		</div>
	</div>
</div>



<!-- Roll Templates -->

<rolltemplate class="sheet-rolltemplate-frostpunk">
	<div class="template-wrap">
		<div class="template-header">
			{{#character_name}}
			{{#character_id}}[{{character_name}}](https://journal.roll20.net/character/{{character_id}}){{/character_id}}
			{{^character_id}}{{character_name}}{{/character_id}}
			{{/character_name}}
		</div>

		<div class="template-subtitle">
			{{roll-name}}
		</div>

		<label class="template-label">Kości podstawowe: {{base-dice}}</label>
		<div class="template-grid">
			{{#rollGreater() base-dice 0}}
			<!-- BASE DIE ONE -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-one 1 5}}
				<div class="template-roll-between">{{base-roll-one}}</div>
				{{/rollBetween() base-roll-one 1 5}}
				{{#rollWasCrit() base-roll-one}}
				<div class="template-roll-success">{{base-roll-one}}</div>
				{{/rollWasCrit() base-roll-one}}
			</div>
			{{/rollGreater() base-dice 0}}

			{{#rollGreater() base-dice 1}}
			<!-- BASE DIE TWO -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-two 1 5}}
				<div class="template-roll-between">{{base-roll-two}}</div>
				{{/rollBetween() base-roll-two 1 5}}
				{{#rollWasCrit() base-roll-two}}
				<div class="template-roll-success">{{base-roll-two}}</div>
				{{/rollWasCrit() base-roll-two}}
			</div>
			{{/rollGreater() base-dice 1}}

			{{#rollGreater() base-dice 2}}
			<!-- BASE DIE THREE -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-three 1 5}}
				<div class="template-roll-between">{{base-roll-three}}</div>
				{{/rollBetween() base-roll-three 1 5}}
				{{#rollWasCrit() base-roll-three}}
				<div class="template-roll-success hit">{{base-roll-three}}</div>
				{{/rollWasCrit() base-roll-three}}
			</div>
			{{/rollGreater() base-dice 2}}

			{{#rollGreater() base-dice 3}}
			<!-- BASE DIE FOUR -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-four 1 5}}
				<div class="template-roll-between">{{base-roll-four}}</div>
				{{/rollBetween() base-roll-four 1 5}}
				{{#rollWasCrit() base-roll-four}}
				<div class="template-roll-success hit">{{base-roll-four}}</div>
				{{/rollWasCrit() base-roll-four}}
			</div>
			{{/rollGreater() base-dice 3}}

			{{#rollGreater() base-dice 4}}
			<!-- BASE DIE FIVE -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-five 1 5}}
				<div class="template-roll-between">{{base-roll-five}}</div>
				{{/rollBetween() base-roll-five 1 5}}
				{{#rollWasCrit() base-roll-five}}
				<div class="template-roll-success hit">{{base-roll-five}}</div>
				{{/rollWasCrit() base-roll-five}}
			</div>
			{{/rollGreater() base-dice 4}}

			{{#rollGreater() base-dice 5}} <!-- BASE DIE SIX -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-six 1 5}}
					<div class="template-roll-between">{{base-roll-six}}</div>
				{{/rollBetween() base-roll-six 1 5}}
				{{#rollWasCrit() base-roll-six}}
					<div class="template-roll-success hit">{{base-roll-six}}</div>
				{{/rollWasCrit() base-roll-six}}
			</div>
			{{/rollGreater() base-dice 5}}
			
			{{#rollGreater() base-dice 6}} <!-- BASE DIE SEVEN -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-seven 1 5}}
					<div class="template-roll-between">{{base-roll-seven}}</div>
				{{/rollBetween() base-roll-seven 1 5}}
				{{#rollWasCrit() base-roll-seven}}
					<div class="template-roll-success hit">{{base-roll-seven}}</div>
				{{/rollWasCrit() base-roll-seven}}
			</div>
			{{/rollGreater() base-dice 6}}
			
			{{#rollGreater() base-dice 7}} <!-- BASE DIE EIGHT -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-eight 1 5}}
					<div class="template-roll-between">{{base-roll-eight}}</div>
				{{/rollBetween() base-roll-eight 1 5}}
				{{#rollWasCrit() base-roll-eight}}
					<div class="template-roll-success hit">{{base-roll-eight}}</div>
				{{/rollWasCrit() base-roll-eight}}
			</div>
			{{/rollGreater() base-dice 7}}
			
			{{#rollGreater() base-dice 8}} <!-- BASE DIE NINE -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-nine 1 5}}
					<div class="template-roll-between">{{base-roll-nine}}</div>
				{{/rollBetween() base-roll-nine 1 5}}
				{{#rollWasCrit() base-roll-nine}}
					<div class="template-roll-success hit">{{base-roll-nine}}</div>
				{{/rollWasCrit() base-roll-nine}}
			</div>
			{{/rollGreater() base-dice 8}}
			
			{{#rollGreater() base-dice 9}} <!-- BASE DIE TEN -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-ten 1 5}}
					<div class="template-roll-between">{{base-roll-ten}}</div>
				{{/rollBetween() base-roll-ten 1 5}}
				{{#rollWasCrit() base-roll-ten}}
					<div class="template-roll-success hit">{{base-roll-ten}}</div>
				{{/rollWasCrit() base-roll-ten}}
			</div>
			{{/rollGreater() base-dice 9}}
			
			{{#rollGreater() base-dice 10}} <!-- BASE DIE ELEVEN -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-eleven 1 5}}
					<div class="template-roll-between">{{base-roll-eleven}}</div>
				{{/rollBetween() base-roll-eleven 1 5}}
				{{#rollWasCrit() base-roll-eleven}}
					<div class="template-roll-success hit">{{base-roll-eleven}}</div>
				{{/rollWasCrit() base-roll-eleven}}
			</div>
			{{/rollGreater() base-dice 10}}
			
			{{#rollGreater() base-dice 11}} <!-- BASE DIE TWELVE -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-twelve 1 5}}
					<div class="template-roll-between">{{base-roll-twelve}}</div>
				{{/rollBetween() base-roll-twelve 1 5}}
				{{#rollWasCrit() base-roll-twelve}}
					<div class="template-roll-success hit">{{base-roll-twelve}}</div>
				{{/rollWasCrit() base-roll-twelve}}
			</div>
			{{/rollGreater() base-dice 11}}
			
			{{#rollGreater() base-dice 12}} <!-- BASE DIE THIRTEEN -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-thirteen 1 5}}
					<div class="template-roll-between">{{base-roll-thirteen}}</div>
				{{/rollBetween() base-roll-thirteen 1 5}}
				{{#rollWasCrit() base-roll-thirteen}}
					<div class="template-roll-success hit">{{base-roll-thirteen}}</div>
				{{/rollWasCrit() base-roll-thirteen}}
			</div>
			{{/rollGreater() base-dice 12}}
			
			{{#rollGreater() base-dice 13}} <!-- BASE DIE FOURTEEN -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-fourteen 1 5}}
					<div class="template-roll-between">{{base-roll-fourteen}}</div>
				{{/rollBetween() base-roll-fourteen 1 5}}
				{{#rollWasCrit() base-roll-fourteen}}
					<div class="template-roll-success hit">{{base-roll-fourteen}}</div>
				{{/rollWasCrit() base-roll-fourteen}}
			</div>
			{{/rollGreater() base-dice 13}}
			
			{{#rollGreater() base-dice 14}} <!-- BASE DIE FIFTEEN -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-fifteen 1 5}}
					<div class="template-roll-between">{{base-roll-fifteen}}</div>
				{{/rollBetween() base-roll-fifteen 1 5}}
				{{#rollWasCrit() base-roll-fifteen}}
					<div class="template-roll-success hit">{{base-roll-fifteen}}</div>
				{{/rollWasCrit() base-roll-fifteen}}
			</div>
			{{/rollGreater() base-dice 14}}

			{{#rollGreater() base-dice 15}} <!-- BASE DIE SIXTEEN -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-sixteen 1 5}}
					<div class="template-roll-between">{{base-roll-sixteen}}</div>
				{{/rollBetween() base-roll-sixteen 1 5}}
				{{#rollWasCrit() base-roll-sixteen}}
					<div class="template-roll-success hit">{{base-roll-sixteen}}</div>
				{{/rollWasCrit() base-roll-sixteen}}
			</div>
			{{/rollGreater() base-dice 15}}
			
			{{#rollGreater() base-dice 16}} <!-- BASE DIE SEVENTEEN -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-seventeen 1 5}}
					<div class="template-roll-between">{{base-roll-seventeen}}</div>
				{{/rollBetween() base-roll-seventeen 1 5}}
				{{#rollWasCrit() base-roll-seventeen}}
					<div class="template-roll-success hit">{{base-roll-seventeen}}</div>
				{{/rollWasCrit() base-roll-seventeen}}
			</div>
			{{/rollGreater() base-dice 16}}

			{{#rollGreater() base-dice 17}} <!-- BASE DIE EIGHTEEN -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-eighteen 1 5}}
					<div class="template-roll-between">{{base-roll-eighteen}}</div>
				{{/rollBetween() base-roll-eighteen 1 5}}
				{{#rollWasCrit() base-roll-eighteen}}
					<div class="template-roll-success hit">{{base-roll-eighteen}}</div>
				{{/rollWasCrit() base-roll-eighteen}}
			</div>
			{{/rollGreater() base-dice 17}}

			{{#rollGreater() base-dice 18}} <!-- BASE DIE NINETEEN -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-nineteen 1 5}}
					<div class="template-roll-between">{{base-roll-nineteen}}</div>
				{{/rollBetween() base-roll-nineteen 1 5}}
				{{#rollWasCrit() base-roll-nineteen}}
					<div class="template-roll-success hit">{{base-roll-nineteen}}</div>
				{{/rollWasCrit() base-roll-nineteen}}
			</div>
			{{/rollGreater() base-dice 18}}

			{{#rollGreater() base-dice 19}} <!-- BASE DIE TWENTY -->
			<div class="template-grid-item">
				{{#rollBetween() base-roll-twenty 1 5}}
					<div class="template-roll-between">{{base-roll-twenty}}</div>
				{{/rollBetween() base-roll-twenty 1 5}}
				{{#rollWasCrit() base-roll-twenty}}
					<div class="template-roll-success hit">{{base-roll-twenty}}</div>
				{{/rollWasCrit() base-roll-twenty}}
			</div>
			{{/rollGreater() base-dice 19}}
		</div>

		{{#gear-dice}}
		<label class="template-label">Kości wyposażenia: {{gear-dice}}</label>
		<div class="template-grid">
			{{#rollGreater() gear-dice 0}}
			<!-- GEAR DIE ONE -->
			<div class="template-grid-item">
				{{#rollBetween() gear-roll-one 1 5}}
				<div class="template-roll-between">{{gear-roll-one}}</div>
				{{/rollBetween() gear-roll-one 1 5}}
				{{#rollWasCrit() gear-roll-one}}
				<div class="template-roll-success">{{gear-roll-one}}</div>
				{{/rollWasCrit() gear-roll-one}}
			</div>
			{{/rollGreater() gear-dice 0}}

			{{#rollGreater() gear-dice 1}}
			<!-- GEAR DIE TWO -->
			<div class="template-grid-item">
				{{#rollBetween() gear-roll-two 1 5}}
				<div class="template-roll-between">{{gear-roll-two}}</div>
				{{/rollBetween() gear-roll-two 1 5}}
				{{#rollWasCrit() gear-roll-two}}
				<div class="template-roll-success">{{gear-roll-two}}</div>
				{{/rollWasCrit() gear-roll-two}}
			</div>
			{{/rollGreater() gear-dice 1}}

			{{#rollGreater() gear-dice 2}}
			<!-- GEAR DIE THREE -->
			<div class="template-grid-item">
				{{#rollBetween() gear-roll-three 1 5}}
				<div class="template-roll-between">{{gear-roll-three}}</div>
				{{/rollBetween() gear-roll-three 1 5}}
				{{#rollWasCrit() gear-roll-three}}
				<div class="template-roll-success hit">{{gear-roll-three}}</div>
				{{/rollWasCrit() gear-roll-three}}
			</div>
			{{/rollGreater() gear-dice 2}}

			{{#rollGreater() gear-dice 3}}
			<!-- GEAR DIE FOUR -->
			<div class="template-grid-item">
				{{#rollBetween() gear-roll-four 1 5}}
				<div class="template-roll-between">{{gear-roll-four}}</div>
				{{/rollBetween() gear-roll-four 1 5}}
				{{#rollWasCrit() gear-roll-four}}
				<div class="template-roll-success hit">{{gear-roll-four}}</div>
				{{/rollWasCrit() gear-roll-four}}
			</div>
			{{/rollGreater() gear-dice 3}}

			{{#rollGreater() gear-dice 4}}
			<!-- GEAR DIE FIVE -->
			<div class="template-grid-item">
				{{#rollBetween() gear-roll-five 1 5}}
				<div class="template-roll-between">{{gear-roll-five}}</div>
				{{/rollBetween() gear-roll-five 1 5}}
				{{#rollWasCrit() gear-roll-five}}
				<div class="template-roll-success hit">{{gear-roll-five}}</div>
				{{/rollWasCrit() gear-roll-five}}
			</div>
			{{/rollGreater() gear-dice 4}}
		</div>
		{{/gear-dice}}

	</div>
</rolltemplate>

<script type="text/worker">


	const stats = ["strength", "agility", "wits", "empathy"];

	stats.forEach(stat => {
		on(`change:${stat}`, () => {
			getAttrs([stat], values => {
				const stat_base = values[stat]; 
				
				getAttrs([`${stat}_calc`], function(test) {
					setAttrs({
						[`${stat}_calc`]: stat_base
					}); 
				});
				
			});
		});
	});


    on('clicked:roll', async (event) => {
        var attribute = event.htmlAttributes['data-attribute'];
        var skill = event.htmlAttributes['data-skill'];

        var rollName = attribute;

        if (skill != undefined) {
            rollName = skill;
			skill = '+ @{'+skill+'}';
		} else {
            skill = '';
        }

        var baseDiceTotal = '@{'+attribute+'} - @{'+attribute+'_damage}'+skill+' + ?{Modifiers|0} - (@{condition})';

        const rollBase = '@{secret_roll} &{template:frostpunk} {{character_name=@{character_name}}} {{character_id=@{character_id}}} {{name=^{dice-pool}}} {{roll-name=^{'+rollName+'} }} {{base-dice=[[ '+baseDiceTotal+' ]] }} {{base-roll-one=[[1d6]] }} {{base-roll-two=[[1d6]] }} {{base-roll-three=[[1d6]] }} {{base-roll-four=[[1d6]] }} {{base-roll-five=[[1d6]] }}  {{base-roll-six=[[1d6]] }} {{base-roll-seven=[[1d6]] }} {{base-roll-eight=[[1d6]] }} {{base-roll-nine=[[1d6]] }} {{base-roll-ten=[[1d6]] }} {{base-roll-eleven=[[1d6]] }} {{base-roll-twelve=[[1d6]] }} {{base-roll-thirteen=[[1d6]] }} {{base-roll-fourteen=[[1d6]] }} {{base-roll-fifteen=[[1d6]] }} {{base-roll-sixteen=[[1d6]] }} {{base-roll-seventeen=[[1d6]] }} {{base-roll-eighteen=[[1d6]] }} {{base-roll-nineteen=[[1d6]] }} {{base-roll-twenty=[[1d6]] }}';

        let rollResult = await startRoll(rollBase);

        finishRoll(
            rollResult.rollId
        );
    });

</script>
